(function(){"use strict";var e,t,n,o=document,i=o.documentElement,s=o.body;e=function(e,n){return new t(e,n)},t=function(e,t){var n=[],o=0,i=0,s=t||document;if("string"==typeof e&&e.indexOf("#")>-1)e=e.replace("#",""),n=s.getElementById(e),null!==n?(i=1,this[0]=n):(i=0,this[0]=null);else if("object"==typeof e||"function"==typeof e?n=e:"string"==typeof e&&(n=s.getElementsByTagName(e)),i=n.length||1,1===i)this[0]=n[0]=e;else for(;i>o;o++)this[o]=n[o];return this.length=i,this},n={each:function(e,t,n){var o,i=0,s=e.length,a=void 0===s;if(n)if(a){for(o in e)if(t.apply(e[o],n)===!1)break}else for(;s>i&&t.apply(e[i++],n)!==!1;);else if(a){for(o in e)if(t.call(e[o],o,e[o])===!1)break}else for(;s>i&&t.call(e[i],i,e[i++])!==!1;);return e},hasClass:function(e,t){return e.className.match(RegExp("(\\s|^)"+t+"(\\s|$)"))},addEvent:function(e,t,n,o){if(e.addEventListener)try{e.addEventListener(t,n,!1)}catch(i){if("object"!=typeof n||!n.handleEvent)throw i;e.addEventListener(t,function(e){n.handleEvent.call(n,e)},!1)}else if(e.attachEvent)if(o===!0){var s=e;e.attachEvent("on"+t,function(e){n.apply(s,[e])})}else e.attachEvent("on"+t,n)},removeEvent:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},customEvent:function(){var e=function(){this._listeners={}};return e.prototype={constructor:e,add:function(e,t){this._listeners[e]===void 0&&(this._listeners[e]=[]),this._listeners[e].push(t)},trigger:function(e){if("string"==typeof e&&(e={type:e}),e.target||(e.target=this),!e.type)throw Error('Event object missing "type" property.');if(this._listeners[e.type]instanceof Array)for(var t=this._listeners[e.type],n=t.length,o=0;n>o;o++)t[o].call(this,e)},remove:function(e,t){if(this._listeners[e]instanceof Array)for(var n=this._listeners[e],o=n.length,i=0;o>i;i++)if(n[i]===t){n.splice(i,1);break}}},new e}},n.fastClick=function(e,t){this.element=e,this.handler=t,this.moveThreshold=10,n.addEvent(e,"touchstart",this,!1),n.addEvent(e,"click",this,!1)},n.fastClick.prototype.handleEvent=function(e){switch(this.event=e||window.event,this.touch=+e.touches[0],e.type){case"touchstart":this.onTouchStart();break;case"touchmove":this.onTouchMove();break;case"touchend":this.onClick();break;case"click":this.onClick()}},n.fastClick.prototype.onTouchStart=function(){this.event.stopPropagation(),this.element.addEventListener("touchend",this,!1),s.addEventListener("touchmove",this,!1),this.startX=this.touch.clientX,this.startY=this.touch.clientY},n.fastClick.prototype.onTouchMove=function(){(Math.abs(this.touch.clientX-this.startX)>this.moveThreshold||Math.abs(this.touch.clientY-this.startY)>this.moveThreshold)&&this.reset()},n.fastClick.prototype.onClick=function(){var e=this.event;e.stopPropagation&&event.stopPropagation(),this.reset(),this.handler.apply(e.currentTarget,[e]),"touchend"===e.type&&n.preventGhostClick(this.startX,this.startY)},n.fastClick.prototype.reset=function(){n.removeEvent(this.element,"touchend",this,!1),n.removeEvent(s,"touchmove",this,!1)},n.fastClick.prototype.unbind=function(){n.removeEvent(this.element,"click",this),n.removeEvent(this.element,"touchstart",this),n.removeEvent(this.element,"touchend",this),n.removeEvent(this.element,"touchmove",this)},n.coords=[],n.preventGhostClick=function(e,t){n.coords.push(e,t),window.setTimeout(function(){n.coords.splice(0,2)},2500)},n.dodgyAndroid="ontouchstart"in window&&-1!=navigator.userAgent.indexOf("Android 2.3"),o.addEventListener&&o.addEventListener("click",n.ghostClickHandler,!0),n.addEvent(document.documentElement,"touchstart",function(){n.hadTouchEvent=!0},!1),n.ghostClickHandler=function(e){if(!n.hadTouchEvent&&n.dodgyAndroid)return e.stopPropagation(),e.preventDefault(),void 0;for(var t=0,o=n.coords.length;o>t;t+=2){var i=n.coords[t],s=n.coords[t+1];25>Math.abs(e.clientX-i)&&25>Math.abs(e.clientY-s)&&(e.stopPropagation(),e.preventDefault())}},t.prototype={each:function(e,t){return n.each(this,e,t)},show:function(){return n.each(this,function(){this.style.display="block"}),this},hide:function(){return n.each(this,function(){this.style.display="none"}),this},remove:function(){return n.each(this,function(){this.parentNode.removeChild(this)}),this},hasClass:function(e){var t=!1;return n.each(this,function(){n.hasClass(this,e)&&(t=!0)}),t},removeClass:function(e){return n.each(this,function(){if(n.hasClass(this,e)){var t=RegExp("(\\s|^)"+e+"(\\s|$)");this.className=this.className.replace(t," ")}}),this},addClass:function(e){return n.each(this,function(){n.hasClass(this,e)||(this.className+=" "+e)}),this},append:function(e){var t,i=o.createDocumentFragment(),s=o.createElement("div"),a=0;for("string"==typeof e?s.innerHTML=e:"object"==typeof e&&s.appendChild(e),t=s.childNodes.length;t>a;a++)i.appendChild(s.childNodes[a].cloneNode(!0));return n.each(this,function(){this.appendChild(i)}),this},addEvent:function(e,t,o,i){return"click"===e&&void 0!==document.ontouchstart?n.each(this,function(){this.fastClick=new n.fastClick(this,t)}):i?n.each(this,function(){this.customEvent||(this.customEvent=n.customEvent()),this.customEvent.add(e,t)}):n.each(this,function(){n.addEvent(this,e,t,o)}),this},removeEvent:function(e,t,o){return"click"===e&&void 0!==document.ontouchstart?n.each(this,function(){this.fastClick.unbind()}):o?n.each(this,function(){this.customEvent&&this.customEvent.remove(e,t)}):n.each(this,function(){n.removeEvent(this,e,t)}),this},trigger:function(e){return n.each(this,function(){this.customEvent&&this.customEvent.trigger({type:e,target:this})}),this},chainEvents:function(e,t,o){return n.each(this,function(){var i=0,s=function(){t[i].apply(this),n.removeEvent(this,e,s),i++,t[i]&&(o?setTimeout(function(){n.addEvent(this,e,s)},0):n.addEvent(this,e,s))};n.addEvent(this,e,s,!1)}),this},attr:function(e){var t;if(this[0].getAttribute)t=this[0].getAttribute(e);else if(!t)for(var n=this.attributes||[],o=n.length,i=0;o>i;i++)n[i].nodeName===e&&(t=n[i].nodeValue);return t}},e.support={transitionEvent:function(){var e,t,n=o.createElement("test"),s={transition:"transitionEnd",OTransition:"oTransitionEnd",MSTransition:"msTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in s)void 0!==n.style[e]&&(t=s[e]);return t||(i.className+=" no-transition-event"),t||!1}(),storage:function(){try{return"localStorage"in window&&null!==window.localStorage&&void 0!==window.localStorage}catch(e){return i.className+=" no-storage",!1}}(),audio:function(){var e=o.createElement("audio"),t=!!e.canPlayType&&""!==e.canPlayType("audio/mpeg"),n=!!e.canPlayType&&""!==e.canPlayType('audio/ogg; codecs="vorbis"'),s="";if(e.canPlayType){if(t)s="mp3";else{if(!n)return!1;s="ogg"}return s}return i.className+=" no-audio",!1}(),fullscreen:function(){var e={enable:function(e){var t=i.requestFullscreen||i.mozRequestFullScreen||i.webkitRequestFullScreen;return e||t.call(i),t||!1},cancel:function(e){var t=o.exitFullscreen||o.cancelFullScreen||o.mozCancelFullScreen||o.webkitCancelFullScreen;return e||t.call(o),t||!1}};return e.enable(!0)&&e.cancel(!0)?e:(i.className+=" no-fullscreen",!1)}()},e.delay=function(e,t,n){n=arguments.length>2?n:t,setTimeout(function(){e(t)},n)},e.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},e.docHeight=function(){return Math.max(Math.max(s.offsetHeight,i.offsetHeight),Math.max(s.clientHeight,i.clientHeight))},e.docWidth=function(){return Math.max(Math.max(s.offsetWidth,i.offsetWidth),Math.max(s.clientWidth,i.clientWidth))},e.storage=e.support.storage?window.localStorage:{},window.lib=window.$=e})(),function(){"use strict";var e=function(e){this.src=e,this.registry={},this.audio=document.createElement("audio"),this.audio.autobuffer=!0,this.audio.load()};e.prototype.load=function(e){var t,n=this,o=navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?!0:!1;if(this.audio.canPlayType('audio/ogg; codecs="vorbis"')?t="ogg":this.audio.canPlayType('audio/mpeg; codecs="mp3"')&&(t="mp3"),t){if(this.audio.src=this.src+t,o){var i=document.documentElement,s=function(){i.removeEventListener("touchstart",s,!0),n.audio.play(),setTimeout(function(){n.audio.pause()},1e3)};return i.addEventListener("touchstart",s,!0),e(),void 0}var a=function(){$(this).removeEvent("canplaythrough",a),"function"==typeof e&&e()};$(this.audio).addEvent("canplaythrough",a,!1)}return this},e.prototype.register=function(e,t,n){return this.registry[e]={start:t,end:n},this},e.prototype.play=function(e,t){if(!this.registry[e])return console.log("could not find the track"),void 0;if(UI.status.muted===!1){this.audio.volume=t||1,this.audio.pause(),this.audio.currentTime=this.registry[e].start,this.audio.play(),this.timer=null;var n=this;clearTimeout(this.timer);var o=function(){n.audio.currentTime>=n.registry[e].end?(n.audio.pause(),clearTimeout(n.timer)):setTimeout(o,10)};this.timer=setTimeout(o,10)}return this},window.AudioSprite=e}(),function(){"use strict";var e={blockSize:80,el:$("#play")[0],size:480,offset:{left:null,top:null}};e.offset.left=e.el.offsetLeft,e.offset.top=e.el.offsetTop,window.board=e}(),function(e){"use strict";var t=function(t,n,o,i,s){var a=e.blockSize*o,r=e.blockSize,l=Math.floor(3*Math.random())+1;s&&(l=4),this.dir=i,this.isKey=s,this.top=t*e.blockSize,this.left=n*e.blockSize,this.w="h"===i?a:r,this.h="h"===i?r:a,this.styles="width:"+this.w+"px; height:"+this.h+"px; top:"+this.top+"px; left:"+this.left+"px;",this.classAttr="row-"+t+" col-"+n+" block dir-"+i+" size-"+o+" delay-"+l+" "+(s?"key":"")};window.Block=t}(window.board),function(e){"use strict";window.puzzle=[{parMoves:8,blocks:[new e(2,1,2,"h",!0),new e(0,0,2,"h",!1),new e(0,5,3,"v",!1),new e(0,3,3,"v",!1),new e(1,0,3,"v",!1),new e(4,0,2,"v",!1),new e(4,4,2,"h",!1),new e(5,3,3,"h",!1)]},{parMoves:14,blocks:[new e(2,0,2,"h",!0),new e(2,3,3,"v",!1),new e(3,1,2,"h",!1),new e(3,5,3,"v",!1),new e(4,1,2,"v",!1),new e(5,2,2,"h",!1)]},{parMoves:12,blocks:[new e(2,1,2,"h",!0),new e(0,0,3,"v",!1),new e(3,0,3,"h",!1),new e(0,1,3,"h",!1),new e(0,4,2,"h",!1),new e(4,2,2,"v",!1),new e(4,3,3,"h",!1),new e(1,5,3,"v",!1)]},{parMoves:9,blocks:[new e(2,1,2,"h",!0),new e(0,0,3,"v",!1),new e(0,3,3,"v",!1),new e(3,2,2,"v",!1),new e(3,3,3,"h",!1),new e(5,2,3,"h",!1),new e(4,5,2,"v",!1)]},{parMoves:9,blocks:[new e(2,1,2,"h",!0),new e(0,0,2,"h",!1),new e(0,3,2,"v",!1),new e(1,0,2,"h",!1),new e(1,4,3,"v",!1),new e(1,5,3,"v",!1),new e(2,3,3,"v",!1),new e(3,0,2,"h",!1),new e(3,2,2,"v",!1),new e(4,0,2,"v",!1),new e(5,3,3,"h",!1)]},{parMoves:12,blocks:[new e(2,0,2,"h",!0),new e(0,1,2,"v",!1),new e(0,2,2,"h",!1),new e(0,4,2,"h",!1),new e(1,3,2,"v",!1),new e(1,4,2,"h",!1),new e(2,4,3,"v",!1),new e(2,5,2,"v",!1),new e(3,0,3,"v",!1),new e(3,1,3,"h",!1),new e(4,2,2,"v",!1),new e(4,5,2,"v",!1)]},{parMoves:17,blocks:[new e(2,0,2,"h",!0),new e(0,0,2,"v",!1),new e(0,1,2,"h",!1),new e(0,5,3,"v",!1),new e(1,2,3,"v",!1),new e(3,3,3,"h",!1),new e(4,4,2,"v",!1),new e(5,0,3,"h",!1)]},{parMoves:17,blocks:[new e(2,2,2,"h",!0),new e(0,0,2,"h",!1),new e(0,2,2,"v",!1),new e(1,4,2,"h",!1),new e(2,0,2,"v",!1),new e(2,1,2,"v",!1),new e(2,4,2,"v",!1),new e(2,5,2,"v",!1),new e(3,2,2,"h",!1),new e(4,2,2,"v",!1),new e(4,4,2,"h",!1),new e(5,0,2,"h",!1)]},{parMoves:11,blocks:[new e(2,0,2,"h",!0),new e(0,1,2,"h",!1),new e(0,3,2,"h",!1),new e(0,5,2,"v",!1),new e(1,4,2,"v",!1),new e(2,5,3,"v",!1),new e(3,0,2,"h",!1),new e(3,2,2,"v",!1),new e(3,4,2,"v",!1),new e(4,0,2,"v",!1),new e(5,1,2,"h",!1),new e(5,3,3,"h",!1)]},{parMoves:8,blocks:[new e(2,0,2,"h",!0),new e(0,2,2,"v",!1),new e(0,3,3,"h",!1),new e(1,3,2,"v",!1),new e(2,5,3,"v",!1),new e(3,1,2,"h",!1),new e(3,3,2,"h",!1),new e(4,0,2,"v",!1),new e(4,1,2,"v",!1),new e(4,2,2,"h",!1),new e(5,4,2,"h",!1)]},{parMoves:22,blocks:[new e(2,2,2,"h",!0),new e(0,2,2,"v",!1),new e(0,3,2,"h",!1),new e(1,4,2,"v",!1),new e(2,1,2,"v",!1),new e(3,2,2,"h",!1),new e(3,4,2,"v",!1),new e(4,1,3,"h",!1)]},{parMoves:24,blocks:[new e(2,0,2,"h",!0),new e(0,0,2,"v",!1),new e(0,1,3,"h",!1),new e(1,2,2,"h",!1),new e(1,4,2,"h",!1),new e(2,2,2,"v",!1),new e(3,0,2,"h",!1),new e(3,3,3,"v",!1),new e(4,0,3,"h",!1),new e(4,4,2,"v",!1),new e(4,5,2,"v",!1),new e(5,0,3,"h",!1)]},{parMoves:23,blocks:[new e(2,2,2,"h",!0),new e(0,1,2,"h",!1),new e(0,3,2,"h",!1),new e(1,0,2,"h",!1),new e(1,2,2,"h",!1),new e(1,4,3,"v",!1),new e(1,5,3,"v",!1),new e(2,0,3,"v",!1),new e(2,1,3,"v",!1),new e(3,2,2,"v",!1),new e(3,3,2,"v",!1),new e(4,4,2,"h",!1),new e(5,1,2,"h",!1),new e(5,3,2,"h",!1)]},{parMoves:22,blocks:[new e(2,1,2,"h",!0),new e(2,3,2,"h",!0),new e(0,0,3,"v",!1),new e(0,1,3,"h",!1),new e(0,4,2,"h",!1),new e(1,5,3,"v",!1),new e(3,0,3,"h",!1),new e(4,2,2,"v",!1),new e(4,3,3,"h",!1)]},{parMoves:32,blocks:[new e(2,1,2,"h",!0),new e(0,0,2,"h",!1),new e(0,2,2,"v",!1),new e(0,4,2,"h",!1),new e(1,0,2,"h",!1),new e(1,5,3,"v",!1),new e(2,0,3,"v",!1),new e(2,4,2,"v",!1),new e(3,1,3,"h",!1),new e(4,1,2,"v",!1),new e(4,3,2,"v",!1),new e(4,4,2,"h",!1),new e(5,4,2,"h",!1)]},{parMoves:25,blocks:[new e(2,0,2,"h",!0),new e(2,2,2,"h",!0),new e(0,1,2,"h",!1),new e(0,3,2,"h",!1),new e(0,5,2,"v",!1),new e(1,4,2,"v",!1),new e(2,5,3,"v",!1),new e(3,0,2,"h",!1),new e(3,2,2,"v",!1),new e(3,4,2,"v",!1),new e(4,0,2,"v",!1),new e(5,1,2,"h",!1),new e(5,3,3,"h",!1)]},{parMoves:25,blocks:[new e(2,0,2,"h",!0),new e(2,3,2,"h",!0),new e(0,0,2,"v",!1),new e(0,1,2,"h",!1),new e(0,3,2,"v",!1),new e(1,1,2,"h",!1),new e(1,4,2,"h",!1),new e(2,2,3,"v",!1),new e(2,5,3,"v",!1),new e(3,3,2,"h",!1),new e(4,3,2,"v",!1),new e(5,1,2,"h",!1),new e(5,4,2,"h",!1)]},{parMoves:47,blocks:[new e(2,1,2,"h",!0),new e(0,0,2,"h",!1),new e(0,2,2,"v",!1),new e(0,4,2,"h",!1),new e(1,0,2,"h",!1),new e(1,4,3,"v",!1),new e(1,5,3,"v",!1),new e(2,0,3,"v",!1),new e(3,1,3,"h",!1),new e(4,3,2,"v",!1),new e(4,4,2,"h",!1),new e(5,0,2,"h",!1),new e(5,4,2,"h",!1)]},{parMoves:31,blocks:[new e(2,0,2,"h",!0),new e(2,3,2,"h",!0),new e(0,1,2,"v",!1),new e(0,2,3,"v",!1),new e(0,3,3,"h",!1),new e(2,5,2,"v",!1),new e(3,0,2,"v",!1),new e(3,1,2,"h",!1),new e(3,3,2,"v",!1),new e(3,4,2,"v",!1),new e(4,5,2,"v",!1),new e(5,0,2,"h",!1),new e(5,2,3,"h",!1)]},{parMoves:32,blocks:[new e(2,0,2,"h",!0),new e(2,3,2,"h",!0),new e(0,1,2,"v",!1),new e(0,2,3,"v",!1),new e(1,4,2,"h",!1),new e(2,5,3,"v",!1),new e(3,0,2,"v",!1),new e(3,1,2,"h",!1),new e(3,3,2,"h",!1),new e(4,1,2,"h",!1),new e(4,3,2,"v",!1),new e(5,4,2,"h",!1)]},{parMoves:34,blocks:[new e(2,0,2,"h",!0),new e(0,0,2,"v",!1),new e(0,1,2,"v",!1),new e(3,0,2,"v",!1),new e(0,2,2,"h",!1),new e(0,4,2,"h",!1),new e(1,2,3,"h",!1),new e(1,5,3,"v",!1),new e(2,2,2,"v",!1),new e(3,3,2,"h",!1),new e(4,1,2,"h",!1),new e(4,3,2,"v",!1),new e(5,4,2,"h",!1)]},{parMoves:33,blocks:[new e(2,0,2,"h",!0),new e(2,2,2,"h",!0),new e(0,1,2,"h",!1),new e(0,3,2,"h",!1),new e(0,5,3,"v",!1),new e(1,1,2,"h",!1),new e(1,4,2,"v",!1),new e(3,0,2,"h",!1),new e(3,2,2,"v",!1),new e(3,4,2,"h",!1),new e(4,0,2,"v",!1),new e(4,3,3,"h",!1),new e(5,1,3,"h",!1),new e(5,4,2,"h",!1)]},{parMoves:31,blocks:[new e(2,1,2,"h",!0),new e(0,2,2,"v",!1),new e(0,3,3,"h",!1),new e(1,0,2,"v",!1),new e(1,3,3,"v",!1),new e(1,4,2,"h",!1),new e(3,1,2,"v",!1),new e(3,4,2,"h",!1),new e(4,0,2,"v",!1),new e(4,2,2,"h",!1),new e(4,5,2,"v",!1),new e(5,1,3,"h",!1)]},{parMoves:37,blocks:[new e(2,0,2,"h",!0),new e(2,3,2,"h",!0),new e(0,0,2,"h",!1),new e(0,2,3,"h",!1),new e(0,5,3,"v",!1),new e(1,0,2,"h",!1),new e(1,2,3,"v",!1),new e(3,3,2,"v",!1),new e(3,4,2,"h",!1),new e(4,0,2,"v",!1),new e(4,1,2,"h",!1),new e(5,1,2,"h",!1),new e(5,3,2,"h",!1)]},{parMoves:51,blocks:[new e(2,3,2,"h",!0),new e(0,0,3,"v",!1),new e(0,1,2,"h",!1),new e(0,4,2,"v",!1),new e(1,1,2,"v",!1),new e(1,2,2,"v",!1),new e(1,5,3,"v",!1),new e(3,0,3,"h",!1),new e(3,3,2,"v",!1),new e(4,2,2,"v",!1),new e(4,4,2,"h",!1),new e(5,0,2,"h",!1),new e(5,3,2,"h",!1)]}]}(window.Block),function(e){"use strict";var t={initialMouseX:void 0,initialMouseY:void 0,startX:void 0,startY:void 0,n:0,dir:void 0,noMove:!0,isKey:!1,_max:null,_min:null,draggedObject:void 0,blockIsAtMaxPosition:!1,blockIsAtMinPosition:!1,event:{move:void 0===document.ontouchstart?"mousemove":"touchmove",end:void 0===document.ontouchstart?"mouseup":"touchend"},startDragMouse:function(e){t.startDrag(this),t.isKey=this.className.indexOf("key")>=0?!0:!1;var n=e||window.event;return n.touches&&n.touches.length?(t.initialMouseX=n.touches[0].clientX,t.initialMouseY=n.touches[0].clientY):(t.initialMouseX=n.clientX,t.initialMouseY=n.clientY),$(document).addEvent(t.event.move,t.dragMouse).addEvent(t.event.end,t.unBind),!1},startDrag:function(n){t.draggedObject&&t.unBind(),t.startX=n.offsetLeft,t.startY=n.offsetTop,t.draggedObject=n,t.draggedObjectHeight=parseInt(n.style.height,10),t.draggedObjectWidth=parseInt(n.style.width,10);var o,i,s,a,r,l,c=n.offsetTop,d=n.offsetLeft;if(n.className.indexOf("dir-h")>=0){t.dir="left";var u=parseInt(n.style.width,10),h=d+window.board.offset.left+1+u;for(a=d+window.board.offset.left-1,r=c+window.board.offset.top+1,l=0;5>l;l++){if(o=document.elementFromPoint(h,r),o!==e.el){i=h;break}h+=e.blockSize}for(t._max=i-window.board.offset.left-u-1,l=0;6>l;l++){if(o=document.elementFromPoint(a-1,r),o!==e.el){s=a;break}a-=e.blockSize}t._min=s-window.board.offset.left+1}else{t.dir="top";var v=parseInt(n.style.height,10),w=c+window.board.offset.top+1+v;for(a=d+window.board.offset.left+1,r=c+window.board.offset.top-1,l=0;5>l;l++){if(o=document.elementFromPoint(a,w),o!==e.el){i=w;break}w+=e.blockSize}for(t._max=i-window.board.offset.top-v-1,l=0;5>l;l++){if(o=document.elementFromPoint(a,r-1),o!==e.el){s=r;break}r-=e.blockSize}t._min=s-window.board.offset.top+1}$(n).addClass("dragged")},dragMouse:function(e){var n,o,i=e||window.event;return i.touches&&i.touches.length?(n=i.touches[0].clientX-t.initialMouseX,o=i.touches[0].clientY-t.initialMouseY):(n=i.clientX-t.initialMouseX,o=i.clientY-t.initialMouseY),t.setPosition(n,o,i),!1},setPosition:function(n,o,i){var s,a=t.dir,r=t._max,l=t._min;if("left"===a){var c=e.elSize-t.draggedObjectWidth;s=t.startX+n,t.isKey?r>=320?l>s?s=l:0>=s?s=0:s>480&&(s=480):s>r?s=r:l>=s?s=l:0>=s?s=0:s>c&&(s=c):s>r?s=r:l>s?s=l:0>=s?s=0:s>c&&(s=c),s!==t.startX&&(t.noMove=!1)}else{var d=e.elSize-t.draggedObjectHeight;s=t.startY+o,s>r?s=r:l>s?s=l:0>s?s=0:s>d&&(s=d),s!==t.startY&&(t.noMove=!1)}t.n=s,s!==r||t.blockIsAtMaxPosition||t.noMove?s!==l||t.blockIsAtMinPosition||t.noMove?(r>s&&(t.blockIsAtMaxPosition=!1),s>l&&(t.blockIsAtMinPosition=!1)):(t.blockIsAtMinPosition=!0,sounds.play("knock",.6)):(!t.isKey||4*e.blockSize>r)&&(t.blockIsAtMaxPosition=!0,sounds.play("knock",.6)),t.draggedObject.style[a]=s+"px",t.isKey&&i.clientX>=$.docWidth()&&t.unBind()},unBind:function(){var n=t.n,o=t.dir,i=Math.round(n/e.blockSize)*e.blockSize,s="left"==t.dir?t.startX:t.startY;if(i*e.blockSize!==n&&(t.draggedObject.style[o]=i+"px"),i*e.blockSize!==n){var a=n-i;0!==a&&(t.isKey===!1||320>n)&&(a=2*(Math.abs(a)/80),sounds.play("knock",a))}if($(document).removeEvent(t.event.move,t.dragMouse).removeEvent(t.event.end,t.unBind),$(t.draggedObject).removeClass("dragged"),i==s&&(t.noMove=!0),t.noMove===!1&&UI.score.update.moves(),t.isKey&&(t.n>=5*e.blockSize||i>=5*e.blockSize))if(1===e.el.querySelectorAll(".block.key").length){game.tutorial.pending||game.puzzle.saveMoves();var r=parseInt($.storage.lvl,10),l=parseInt($.storage.best,10),c=r>=l?!0:!1;game.animate.keyBlock(t.draggedObject,function(){game.puzzle.win(c)}),sounds.play("win",.7)}else game.animate.keyBlock(t.draggedObject);t.n=0,t.draggedObject=null,t.noMove=!0}};window.dragDrop=t}(window.board,window.sounds),function(e,t,n){"use strict";var o={},i={loadDelay:300,maxLevel:e.length};o.$={board:$("#board"),play:$("#play"),"level-list":$("#level-list"),"toggle-menu":$("#toggle-menu"),screenToSmall:$("#too-small"),html:$(document.documentElement)},o.load=function(){var e,t,s=[{src:"/_dev/img/sprite.png",type:"image"},{src:"/_dev/audio/sprite.",type:"audio"}],a=s.length,r=0,l=0;for(t=function(){l++,l===a&&$.delay(o.init,i.loadDelay)},e=function(e,o){if("audio"===o)$.support.audio?(window.sounds=new n(e),window.sounds.load(t),window.sounds.register("knock",2.521,2.6),window.sounds.register("win",3.8,5.865)):t();else if("image"===o){var i=new Image;$(i).addEvent("load",function(){t()}),i.src=e}};a>r;r++)e(s[r].src,s[r].type)},o.puzzle={insert:function(e){for(var n,i=document.createDocumentFragment(),s=e.blocks,a=s.length,r=0,l=void 0===document.ontouchstart?"mousedown":"touchstart";a>r;r++)n=document.createElement("div"),n.style.cssText=s[r].styles,n.className=s[r].classAttr,i.appendChild(n),$(n).addEvent(l,t.startDragMouse,!0);o.$.play[0].appendChild(i),UI.endScreen.disable()},rebind:function(){$("div",o.$.play[0]).addEvent(void 0===document.ontouchstart?"mousedown":"touchstart",t.startDragMouse,!0)},saveMoves:function(){var e=JSON.parse($.storage.bestMoves),t=parseInt(UI.$.movesPlayed[0].innerHTML,10),n=$.storage.lvl,o=e[n];(o>t||!o)&&(e[n]=t,$.storage.bestMoves=JSON.stringify(e),UI.alert.newRecord.show()),UI.score.update.bestMoves()},next:function(){var e=parseInt($.storage.lvl,10)+1;return e>parseInt($.storage.best,10)&&($.storage.best=e,UI.level.unlock(e)),$.storage.lvl=e,e>=i.maxLevel?(e=i.maxLevel,!1):e},win:function(t){var n,i;n=function(){UI.alert.newRecord.hide(),$(window).trigger("levelUpdate"),t===!0&&(UI.alert.newLevel.show(),$.delay(UI.alert.newLevel.hide,3e3))},i=function(){o.$.play[0].innerHTML="";var t=o.puzzle.next();t?(o.puzzle.insert(e[t]),$.delay(function(){o.animate.blocks({where:"in",direction:"bot",force:!0,callback:n})},200)):(UI.endScreen.enable(),$.delay(UI.endScreen.show,200))},o.tutorial.pending&&o.tutorial.onComplete(),o.animate.blocks({where:"out",direction:"far",callback:o.tutorial.pending?o.tutorial.onEnd:i})},init:function(){var t=parseInt($.storage.lvl,10),n=parseInt($.storage.best,10),i=$.storage.bestMoves?JSON.parse($.storage.bestMoves):!1,s=window.puzzle.length-1;t||(t=0),t=Math.min(s,t),$.storage.lvl=t,$.storage.best=n||-1,i||($.storage.bestMoves=JSON.stringify([])),o.puzzle.insert(e[$.storage.lvl]),$(window).trigger("levelUpdate")}},o.tutorial={pending:!0,init:function(){var e=o.$.play,t='<div id="instructions" class="instructions">Slide blocks forward or backward in order to free the red one.</div><div class="instruction-arrow pos-1">&larr;</div><div class="instruction-arrow pos-2">&darr;</div><div class="instruction-arrow pos-3">&rarr;</div>';o.puzzle.insert({blocks:[new Block(2,1,2,"h",!0),new Block(1,3,3,"v",!1),new Block(4,2,3,"h",!1)]}),e.append(t),$(window).addEvent("tutorialReady",this.start,!1,!0)},start:function(){window.getComputedStyle(o.$.play[0]).opacity,o.$.play.addClass("tutorial-ui-in")},onComplete:function(){o.$.play.addClass("tutorial-completed")},onEnd:function(){o.tutorial.pending=!1,$.delay(function(){o.$.play[0].innerHTML="",o.puzzle.init(),o.animate.blocks({where:"in",direction:"bot",force:!0})},200),$(window).trigger("uiReady")}},o.init=function(){$(document.body).addEvent("touchmove",function(e){e.preventDefault()});var e=function(){window.board.offset.left=o.$.play[0].offsetLeft,window.board.offset.top=o.$.play[0].offsetTop},t=!1,n=function(){document.body.style.width="auto";var n=document.body.clientWidth+"px";$("#wrap")[0].style.width=n,document.body.style.width=n,o.screen.isTooSmall()||(t===!1&&i(),e())};$(window).addEvent("resize",n);var i=function(){$(window).addEvent("boardReady",function(){o.$.html.addClass("board-ready")},!1,!0),parseInt($.storage.lvl,10)>=0?(o.tutorial.pending=!1,o.puzzle.init(),o.animate.board(!0,!1)):(o.tutorial.init(),o.animate.board(!1,!0)),$(document.documentElement).addClass("ready"),t=!0};o.screen.isTooSmall()||i()},o.screen={isTooSmall:function(){return"block"===window.getComputedStyle(o.$.screenToSmall[0],null).display?!0:!1},disable:function(e){$("#"+e).show()},enable:function(e){$("#"+e).hide()}},o.animate={board:function(e,t){var n=$.support.transitionEvent;o.$.board.chainEvents(n,[function(){$.delay(o.animate.borders,500)},function(){$(window).trigger("boardReady"),e&&$(window).trigger("uiReady"),$.delay(function(){o.animate.blocks({where:"in",direction:"bot",callback:function(){t&&$(window).trigger("tutorialReady")}})},200)}],!0).addClass("init"),n||(o.animate.borders(),o.animate.blocks({where:"in",direction:"bot"}),$(window).trigger("boardReady"),e&&$(window).trigger("uiReady"),t&&$(window).trigger("tutorialReady"))},borders:function(){o.$.board.addClass("init-border")},blocks:function(e){var t=o.$.play,n=$.support.transitionEvent,i=e.callback,s=function(){t.removeEvent(n,s),"function"==typeof i&&i(),"in"===e.where&&$(window).trigger("puzzleIn")},a="blocks-out-"+e.direction,r="";n&&t.addEvent(n,s),e.force?(t.addClass("blocks-out-bot").removeClass("blocks-out-top").removeClass("blocks-out-far"),n?(r=t[0].innerHTML,t[0].innerHTML="",t[0].innerHTML=r,o.puzzle.rebind(),$.delay(function(){t.removeClass(a)},200)):t.removeClass(a)):"in"===e.where?t.removeClass(a):"out"===e.where&&($(window).trigger("puzzleOut"),t.addClass(a)),n||s()},keyBlock:function(e,t){var n=$(e),o=$.support.transitionEvent,i=function(){n.removeEvent(o,i).remove(),t&&$.delay(t,0)};n.addEvent(o,i).addClass("out"),!o&&t&&t()}},window.game=o}(window.puzzle,window.dragDrop,window.AudioSprite),function(e,t,n){"use strict";var o={};o.$={ui:$("#ui"),board:$("#play"),level:$("#current-level"),fieldLevel:$("#box-current-level"),movesPlayed:$("#moves-played"),movesPar:$("#moves-par"),movesBest:$("#moves-best"),toggleMenu:$("#toggle-menu"),levelList:$("#level-list"),fieldMovesBest:$("#field-moves-best"),fullscreenButton:$("#fullscreen-button"),endScreen:$("#end-screen")},o.status={puzzle:!0,fullscreen:!1,muted:!1,update:function(e,t){o.status[e]=t},init:function(){$(window).addEvent("puzzleOut",function(){o.status.update("puzzle",!1)},!0,!0),$(window).addEvent("puzzleIn",function(){o.status.update("puzzle",!0)},!0,!0);var e=function(){var e=document,t=e.fullscreen||e.mozFullScreen||e.webkitIsFullScreen||!1;o.status.fullscreen=t,t===!0?o.$.fullscreenButton.addClass("enabled"):o.$.fullscreenButton.removeClass("enabled")};$(document).addEvent("fullscreenchange",e),$(document).addEvent("mozfullscreenchange",e),$(document).addEvent("webkitfullscreenchange",e)}},o.buttons={dispatchAction:function(e){$.preventDefault(e);var t=o.buttons.actions[$(this).attr("data-action")],n=$(this).attr("data-requires");"function"!=typeof t||n&&o.status[n]!==!0||t.call(this)},actions:{toggleLevelList:function(){var t=o.$.levelList;t.hasClass("show")?(o.$.endScreen.hasClass("enabled")&&o.endScreen.show(),t.removeClass("show"),e.animate.blocks({where:"in",direction:"top"})):(o.$.endScreen.hasClass("enabled")&&o.endScreen.hide(),t.addClass("show"),e.animate.blocks({where:"out",direction:"top"}))},toggleFullScreen:function(){var e=$.support.fullscreen;e&&(o.status.fullscreen===!1?e.enable():e.cancel())},muteUnmute:function(){o.status.muted===!1?(o.status.update("muted",!0),$(this).addClass("muted")):(o.status.update("muted",!1),$(this).removeClass("muted"))},resetBoard:function(){var t=$(this);t.addClass("anim"),e.animate.blocks({where:"out",direction:"far",callback:function(){o.$.board[0].innerHTML="",e.puzzle.insert(n[$.storage.lvl]),$(window).trigger("levelUpdate"),e.animate.blocks({where:"in",direction:"bot",force:!0,callback:function(){t.removeClass("anim")}})}})},resetLevels:function(){$.storage.lvl=null,$.storage.best=null,$.storage.bestMoves=null}},init:function(){$("a",o.$.ui[0]).addEvent("click",this.dispatchAction,!0)}},o.level={hideList:function(){var t=$.support.transitionEvent,n=function(){o.$.levelList.removeEvent(t,n),e.animate.blocks({where:"in",direction:"bot",force:!0})};t?o.$.levelList.addEvent(t,n):e.animate.blocks({where:"in",direction:"bot",force:!0}),o.$.levelList.removeClass("show")},load:function(t){$.preventDefault(t);var i=parseInt($(this).attr("id").replace("level-",""),10),s=parseInt($.storage.best,10);(s+1>i||-1===s&&0===i)&&(o.$.board[0].innerHTML="",e.puzzle.insert(n[i]),$.storage.lvl=i,$(window).trigger("levelUpdate"),o.level.hideList())},unlock:function(e){$("#level-"+e).removeClass("locked")},init:function(){var e=o.$.levelList[0].getElementsByTagName("a"),t=1,n=parseInt($.storage.best,10);for($(e).addEvent("click",o.level.load,!0);n>=t;t++)o.level.unlock(t)}},o.score={update:{moves:function(e){var t;t=e===!0?0:parseInt(o.$.movesPlayed[0].innerHTML,10)+1,o.$.movesPlayed[0].innerHTML=t},parMoves:function(){o.$.movesPar[0].innerHTML=n[parseInt($.storage.lvl,10)].parMoves},bestMoves:function(){var e=JSON.parse($.storage.bestMoves);e=e[$.storage.lvl]||"â€”",o.$.movesBest[0].innerHTML=e},level:function(){o.$.level[0].innerHTML=parseInt($.storage.lvl,10)+1},all:function(){var e=o.score.update;e.level(),e.parMoves(),e.bestMoves(),e.moves(!0)}},init:function(){$(window).addEvent("levelUpdate",o.score.update.all,!1,!0)}},o.alert={newRecord:{show:function(){o.$.fieldMovesBest.addClass("alert")},hide:function(){o.$.fieldMovesBest.removeClass("alert")}},newLevel:{show:function(){o.$.fieldLevel.addClass("alert")},hide:function(){o.$.fieldLevel.removeClass("alert")}}},o.endScreen={enable:function(){o.$.endScreen.addClass("enabled"),window.getComputedStyle(o.$.endScreen[0]).top},disable:function(){o.$.endScreen.removeClass("enabled")},show:function(){o.$.endScreen.addClass("in"),$.delay(o.alert.newRecord.hide,750)},hide:function(){o.$.endScreen.removeClass("in")}},o.show=function(){o.$.ui.addEvent($.support.transitionEvent,function(){$.delay(function(){$(document.documentElement).addClass("ui-in")},500)}),$(document.documentElement).addClass("ui-ready")},o.init=function(){o.level.init(),o.score.init(),o.buttons.init(),o.status.init(),$(window).addEvent("uiReady",o.show,!1,!0)}(),$(window).addEvent("load",e.load),window.UI=o}(window.game,window.board,window.puzzle);