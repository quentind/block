/* Block Game - v0.1 
 * 2012-09-26
 * 
 * Copyright (c) 2012 Quentin De Smedt;
 * Licensed 
 */
(function(){"use strict";var a=document,b=a.documentElement,c,d,e;c=function(a,b){return new d(a,b)},d=function(a,b){var c=[],d=0,e=0,f=b||document;if(typeof a=="string"&&a.indexOf("#")>-1)a=a.replace("#",""),c=f.getElementById(a),c!==null?(e=1,this[0]=c):(e=0,this[0]=null);else{typeof a=="object"?c=a:typeof a=="string"&&(c=f.getElementsByTagName(a)),e=c.length||1;if(e===1)this[0]=c[0]=a;else for(;d<e;d++)this[d]=c[d]}return this.length=e,this},e={each:function(a,b,c){var d,e=0,f=a.length,g=f===undefined;if(c){if(g){for(d in a)if(b.apply(a[d],c)===!1)break}else for(;e<f;)if(b.apply(a[e++],c)===!1)break}else if(g){for(d in a)if(b.call(a[d],d,a[d])===!1)break}else for(;e<f;)if(b.call(a[e],e,a[e++])===!1)break;return a},hasClass:function(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},addEvent:function(a,b,c,d){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)if(d===!0){var e=a;a.attachEvent("on"+b,function(a){c.apply(e,[a])})}else a.attachEvent("on"+b,c)},removeEvent:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)},customEvent:function(){var a=function(){this._listeners={}};return a.prototype={constructor:a,add:function(a,b){typeof this._listeners[a]=="undefined"&&(this._listeners[a]=[]),this._listeners[a].push(b)},trigger:function(a){typeof a=="string"&&(a={type:a}),a.target||(a.target=this);if(!a.type)throw new Error('Event object missing "type" property.');if(this._listeners[a.type]instanceof Array){var b=this._listeners[a.type],c=b.length,d=0;for(;d<c;d++)b[d].call(this,a)}},remove:function(a,b){if(this._listeners[a]instanceof Array){var c=this._listeners[a],d=c.length,e=0;for(;e<d;e++)if(c[e]===b){c.splice(e,1);break}}}},new a}},d.prototype={each:function(a,b){return e.each(this,a,b)},show:function(){return e.each(this,function(){this.style.display="block"}),this},hide:function(){return e.each(this,function(){this.style.display="none"}),this},remove:function(){return e.each(this,function(){this.parentNode.removeChild(this)}),this},hasClass:function(a){var b=!1;return e.each(this,function(){e.hasClass(this,a)&&(b=!0)}),b},removeClass:function(a){var b=this;return e.each(this,function(){if(e.hasClass(this,a)){var b=new RegExp("(\\s|^)"+a+"(\\s|$)");this.className=this.className.replace(b," ")}}),this},addClass:function(a){var b=this;return e.each(this,function(){e.hasClass(this,a)||(this.className+=" "+a)}),this},addEvent:function(a,b,c,d){return d?e.each(this,function(){this.customEvent||(this.customEvent=e.customEvent()),this.customEvent.add(a,b)}):e.each(this,function(){e.addEvent(this,a,b,c)}),this},removeEvent:function(a,b,c){return c?e.each(this,function(){this.customEvent&&this.customEvent.remove(a,b)}):e.each(this,function(){e.removeEvent(this,a,b)}),this},trigger:function(a){return e.each(this,function(){this.customEvent&&this.customEvent.trigger({type:a,target:this})}),this},chainEvents:function(a,b,c){return e.each(this,function(){var d=0,f=function(g){b[d].apply(this),e.removeEvent(this,a,f),d++,b[d]&&(c?setTimeout(function(){e.addEvent(this,a,f)},0):e.addEvent(this,a,f))};e.addEvent(this,a,f,!1)}),this},attr:function(a){var b;if(this[0].getAttribute)b=this[0].getAttribute(a);else if(!b){var c=this.attributes||[],d=c.length,e=0;for(;e<d;e++)c[e].nodeName===a&&(b=c[e].nodeValue)}return b}},c.support={transitionEvent:function(){var c,d=a.createElement("test"),e={transition:"transitionEnd",OTransition:"oTransitionEnd",MSTransition:"msTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},f;for(c in e)d.style[c]!==undefined&&(f=e[c]);return f||(b.className+=" no-transition-event"),f||!1}(),storage:function(){try{return"localStorage"in window&&window.localStorage!==null&&window.localStorage!==undefined}catch(a){return b.className+=" no-storage",!1}}(),audio:function(){var c=a.createElement("audio"),d=!!c.canPlayType&&""!==c.canPlayType("audio/mpeg"),e=!!c.canPlayType&&""!==c.canPlayType('audio/ogg; codecs="vorbis"'),f="";if(c.canPlayType){if(d)f="mp3";else if(e)f="ogg";else return!1;return f}return b.className+=" no-audio",!1}(),fullscreen:function(){var c=a.documentElement,d={enable:function(a){var b=c.requestFullscreen||c.mozRequestFullScreen||c.webkitRequestFullScreen;return a||b.call(c),b||!1},cancel:function(b){var c=a.exitFullscreen||a.cancelFullScreen||a.mozCancelFullScreen||a.webkitCancelFullScreen;return b||c.call(a),c||!1}};return d.enable(!0)&&d.cancel(!0)?d:(b.className+=" no-fullscreen",!1)}()},c.delay=function(a,b,c){c=arguments.length>2?c:b,setTimeout(function(){a(b)},c)},c.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},c.docHeight=function(){return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))},c.docWidth=function(){return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),Math.max(a.body.clientWidth,a.documentElement.clientWidth))},c.storage=c.support.storage?window.localStorage:{},window.lib=window.$=c})(),function(){"use strict";var a={blockSize:80,el:$("#play")[0],size:480,offset:{left:null,top:null}};a.offset.left=a.el.offsetLeft,a.offset.top=a.el.offsetTop,window.board=a}(),function(a){"use strict";var b=function(b,c,d,e,f){var g=a.blockSize*d,h=a.blockSize,i=Math.floor(Math.random()*3)+1;f&&(i=4),this.dir=e,this.isKey=f,this.top=b*a.blockSize,this.left=c*a.blockSize,this.w=e==="h"?g:h,this.h=e==="h"?h:g,this.styles="width:"+this.w+"px; height:"+this.h+"px; top:"+this.top+"px; left:"+this.left+"px;",this.classAttr="row-"+b+" col-"+c+" block dir-"+e+" size-"+d+" delay-"+i+" "+(f?"key":"")};window.Block=b}(window.board),function(a){"use strict";var b=window.puzzle=[{parMoves:8,blocks:[new a(2,1,2,"h",!0),new a(0,0,2,"h",!1),new a(0,5,3,"v",!1),new a(0,3,3,"v",!1),new a(1,0,3,"v",!1),new a(4,0,2,"v",!1),new a(4,4,2,"h",!1),new a(5,3,3,"h",!1)]},{parMoves:14,blocks:[new a(2,0,2,"h",!0),new a(2,3,3,"v",!1),new a(3,1,2,"h",!1),new a(3,5,3,"v",!1),new a(4,1,2,"v",!1),new a(5,2,2,"h",!1)]},{parMoves:12,blocks:[new a(2,1,2,"h",!0),new a(0,0,3,"v",!1),new a(3,0,3,"h",!1),new a(0,1,3,"h",!1),new a(0,4,2,"h",!1),new a(4,2,2,"v",!1),new a(4,3,3,"h",!1),new a(1,5,3,"v",!1)]},{parMoves:9,blocks:[new a(2,1,2,"h",!0),new a(0,0,3,"v",!1),new a(0,3,3,"v",!1),new a(3,2,2,"v",!1),new a(3,3,3,"h",!1),new a(5,2,3,"h",!1),new a(4,5,2,"v",!1)]},{parMoves:9,blocks:[new a(2,1,2,"h",!0),new a(0,0,2,"h",!1),new a(0,3,2,"v",!1),new a(1,0,2,"h",!1),new a(1,4,3,"v",!1),new a(1,5,3,"v",!1),new a(2,3,3,"v",!1),new a(3,0,2,"h",!1),new a(3,2,2,"v",!1),new a(4,0,2,"v",!1),new a(5,3,3,"h",!1)]},{parMoves:12,blocks:[new a(2,0,2,"h",!0),new a(0,1,2,"v",!1),new a(0,2,2,"h",!1),new a(0,4,2,"h",!1),new a(1,3,2,"v",!1),new a(1,4,2,"h",!1),new a(2,4,3,"v",!1),new a(2,5,2,"v",!1),new a(3,0,3,"v",!1),new a(3,1,3,"h",!1),new a(4,2,2,"v",!1),new a(4,5,2,"v",!1)]},{parMoves:17,blocks:[new a(2,0,2,"h",!0),new a(0,0,2,"v",!1),new a(0,1,2,"h",!1),new a(0,5,3,"v",!1),new a(1,2,3,"v",!1),new a(3,3,3,"h",!1),new a(4,4,2,"v",!1),new a(5,0,3,"h",!1)]},{parMoves:17,blocks:[new a(2,2,2,"h",!0),new a(0,0,2,"h",!1),new a(0,2,2,"v",!1),new a(1,4,2,"h",!1),new a(2,0,2,"v",!1),new a(2,1,2,"v",!1),new a(2,4,2,"v",!1),new a(2,5,2,"v",!1),new a(3,2,2,"h",!1),new a(4,2,2,"v",!1),new a(4,4,2,"h",!1),new a(5,0,2,"h",!1)]},{parMoves:0,blocks:[new a(2,0,2,"h",!0),new a(0,0,2,"v",!1),new a(0,1,3,"h",!1),new a(1,2,2,"h",!1),new a(1,4,2,"h",!1),new a(2,2,2,"v",!1),new a(3,0,2,"h",!1),new a(3,3,3,"v",!1),new a(4,0,3,"h",!1),new a(4,4,2,"v",!1),new a(4,5,2,"v",!1),new a(5,0,3,"h",!1)]},{parMoves:0,blocks:[new a(2,2,2,"h",!0),new a(0,2,2,"v",!1),new a(0,3,2,"h",!1),new a(1,4,2,"v",!1),new a(2,1,2,"v",!1),new a(3,2,2,"h",!1),new a(3,4,2,"v",!1),new a(4,1,3,"h",!1)]},{parMoves:11,blocks:[new a(2,0,2,"h",!0),new a(0,1,2,"h",!1),new a(0,3,2,"h",!1),new a(0,5,2,"v",!1),new a(1,4,2,"v",!1),new a(2,5,3,"v",!1),new a(3,0,2,"h",!1),new a(3,2,2,"v",!1),new a(3,4,2,"v",!1),new a(4,0,2,"v",!1),new a(5,1,2,"h",!1),new a(5,3,3,"h",!1)]},{parMoves:23,blocks:[new a(2,2,2,"h",!0),new a(0,1,2,"h",!1),new a(0,3,2,"h",!1),new a(1,0,2,"h",!1),new a(1,2,2,"h",!1),new a(1,4,3,"v",!1),new a(1,5,3,"v",!1),new a(2,0,3,"v",!1),new a(2,1,3,"v",!1),new a(3,2,2,"v",!1),new a(3,3,2,"v",!1),new a(4,4,2,"h",!1),new a(5,1,2,"h",!1),new a(5,3,2,"h",!1)]},{parMoves:0,blocks:[new a(2,1,2,"h",!0),new a(2,3,2,"h",!0),new a(0,0,3,"v",!1),new a(0,1,3,"h",!1),new a(0,4,2,"h",!1),new a(1,5,3,"v",!1),new a(3,0,3,"h",!1),new a(4,2,2,"v",!1),new a(4,3,3,"h",!1)]},{parMoves:0,blocks:[new a(2,0,2,"h",!0),new a(0,2,2,"v",!1),new a(0,3,3,"h",!1),new a(1,3,2,"v",!1),new a(2,5,3,"v",!1),new a(3,0,2,"h",!1),new a(3,3,2,"h",!1),new a(4,0,2,"v",!1),new a(4,1,2,"v",!1),new a(4,2,2,"h",!1),new a(5,2,2,"h",!1)]},{parMoves:0,blocks:[new a(2,1,2,"h",!0),new a(0,0,2,"h",!1),new a(0,2,2,"v",!1),new a(0,4,2,"h",!1),new a(1,0,2,"h",!1),new a(1,5,3,"v",!1),new a(2,0,3,"v",!1),new a(2,4,2,"v",!1),new a(3,1,3,"h",!1),new a(4,1,2,"v",!1),new a(4,3,2,"v",!1),new a(4,4,2,"h",!1),new a(5,4,2,"h",!1)]},{parMoves:0,blocks:[new a(2,0,2,"h",!0),new a(2,2,2,"h",!0),new a(0,1,2,"h",!1),new a(0,3,2,"h",!1),new a(0,5,2,"v",!1),new a(1,4,2,"v",!1),new a(2,5,3,"v",!1),new a(3,0,2,"h",!1),new a(3,2,2,"v",!1),new a(3,4,2,"v",!1),new a(4,0,2,"v",!1),new a(5,1,2,"h",!1),new a(5,3,3,"h",!1)]},{parMoves:0,blocks:[new a(2,0,2,"h",!0),new a(2,3,2,"h",!0),new a(0,0,2,"v",!1),new a(0,1,2,"h",!1),new a(0,3,2,"v",!1),new a(1,1,2,"h",!1),new a(1,4,2,"h",!1),new a(2,2,3,"v",!1),new a(2,5,3,"v",!1),new a(3,3,2,"h",!1),new a(4,3,2,"v",!1),new a(5,1,2,"h",!1),new a(5,4,2,"h",!1)]},{parMoves:0,blocks:[new a(2,1,2,"h",!0),new a(0,0,2,"h",!1),new a(0,2,2,"v",!1),new a(0,4,2,"h",!1),new a(1,0,2,"h",!1),new a(1,4,3,"v",!1),new a(1,5,3,"v",!1),new a(2,0,3,"v",!1),new a(3,1,3,"h",!1),new a(4,3,2,"v",!1),new a(4,4,2,"h",!1),new a(5,0,2,"h",!1),new a(5,4,2,"h",!1)]},{parMoves:0,blocks:[new a(2,0,2,"h",!0),new a(2,3,2,"h",!0),new a(0,1,2,"v",!1),new a(0,2,3,"v",!1),new a(0,3,3,"h",!1),new a(2,5,2,"v",!1),new a(3,0,2,"v",!1),new a(3,1,2,"h",!1),new a(3,3,2,"v",!1),new a(3,4,2,"v",!1),new a(4,5,2,"v",!1),new a(5,0,2,"h",!1),new a(5,2,3,"h",!1)]},{parMoves:0,blocks:[new a(2,0,2,"h",!0),new a(2,3,2,"h",!0),new a(0,1,2,"v",!1),new a(0,2,3,"v",!1),new a(1,4,2,"h",!1),new a(2,5,3,"v",!1),new a(3,0,2,"v",!1),new a(3,1,2,"h",!1),new a(3,3,2,"h",!1),new a(4,1,2,"h",!1),new a(4,3,2,"v",!1),new a(5,4,2,"h",!1)]},{parMoves:0,blocks:[new a(2,0,2,"h",!0),new a(0,0,2,"v",!1),new a(0,1,2,"v",!1),new a(3,0,2,"v",!1),new a(0,2,2,"h",!1),new a(0,4,2,"h",!1),new a(1,2,3,"h",!1),new a(1,5,3,"v",!1),new a(2,2,2,"v",!1),new a(3,3,2,"h",!1),new a(4,1,2,"h",!1),new a(4,3,2,"v",!1),new a(5,4,2,"h",!1)]},{parMoves:0,blocks:[new a(2,0,2,"h",!0),new a(2,2,2,"h",!0),new a(0,1,2,"h",!1),new a(0,3,2,"h",!1),new a(0,5,3,"v",!1),new a(1,1,2,"h",!1),new a(1,4,2,"v",!1),new a(3,0,2,"h",!1),new a(3,2,2,"v",!1),new a(3,4,2,"h",!1),new a(4,0,2,"v",!1),new a(4,3,3,"h",!1),new a(5,1,3,"h",!1),new a(5,4,2,"h",!1)]},{parMoves:0,blocks:[new a(2,3,2,"h",!0),new a(0,0,3,"v",!1),new a(0,1,2,"h",!1),new a(0,4,2,"v",!1),new a(1,1,2,"v",!1),new a(1,2,2,"v",!1),new a(1,5,3,"v",!1),new a(3,0,3,"h",!1),new a(3,3,2,"v",!1),new a(4,2,2,"v",!1),new a(4,4,2,"h",!1),new a(5,0,2,"h",!1),new a(5,3,2,"h",!1)]},{parMoves:0,blocks:[new a(2,1,2,"h",!0),new a(0,2,2,"v",!1),new a(0,3,3,"h",!1),new a(1,0,2,"v",!1),new a(1,3,3,"v",!1),new a(1,4,2,"h",!1),new a(3,1,2,"v",!1),new a(3,4,2,"h",!1),new a(4,0,2,"v",!1),new a(4,2,2,"h",!1),new a(4,5,2,"v",!1),new a(5,1,3,"h",!1)]},{parMoves:0,blocks:[new a(2,0,2,"h",!0),new a(2,3,2,"h",!0),new a(0,0,2,"h",!1),new a(0,2,3,"h",!1),new a(0,5,3,"v",!1),new a(1,0,2,"h",!1),new a(1,2,3,"v",!1),new a(3,3,2,"v",!1),new a(3,4,2,"h",!1),new a(4,0,2,"v",!1),new a(4,1,2,"h",!1),new a(5,1,2,"h",!1),new a(5,3,2,"h",!1)]}]}(window.Block),function(a,b){"use strict";var c={},d={inited:!1,spriteURL:"_dev/img/sprite.png",loadDelay:300,screen:{minWidth:800,minHeight:600},maxLevel:24};c.load=function(){var a=new Image;a.onload=function(){$.delay(c.init.verify,d.loadDelay)},a.src=d.spriteURL},c.$={board:$("#board"),play:$("#play"),"level-list":$("#level-list"),"toggle-menu":$("#toggle-menu"),html:$(document.documentElement)},c.puzzle={insert:function(a){var d=document.createDocumentFragment(),e=a.blocks,f=e.length,g=0,h;for(;g<f;g++)h=document.createElement("div"),h.style.cssText=e[g].styles,h.className=e[g].classAttr,d.appendChild(h),$(h).addEvent("mousedown",b.startDragMouse,!0);c.$.play[0].appendChild(d)},rebind:function(){$("div",c.$.play[0]).addEvent("mousedown",b.startDragMouse,!0)},saveMoves:function(){var a=JSON.parse($.storage.bestMoves),b=parseInt(UI.$.movesPlayed[0].innerHTML,10),c=$.storage.lvl,d=a[c];if(b<d||!d)a[c]=b,$.storage.bestMoves=JSON.stringify(a),UI.alert.newRecord.show();UI.score.update.bestMoves()},next:function(){var a=parseInt($.storage.lvl,10)+1;return a>=d.maxLevel&&(a=d.maxLevel),a>parseInt($.storage.best,10)&&($.storage.best=a,UI.level.unlock(a)),$.storage.lvl=a,a},win:function(){var b,d;b=function(){UI.alert.newRecord.hide(),$(window).trigger("levelUpdate")},d=function(){c.$.play[0].innerHTML="";var d=c.puzzle.next();d&&(c.puzzle.insert(a[d]),$.delay(function(){c.animate.blocks({where:"in",direction:"bot",force:!0,callback:b})},200))},c.animate.blocks({where:"out",direction:"far",callback:d})},init:function(){var b=parseInt($.storage.lvl,10),d=parseInt($.storage.best,10),e=$.storage.bestMoves?JSON.parse($.storage.bestMoves):!1;$.storage.lvl=b||0,$.storage.best=d||-1,e||($.storage.bestMoves=JSON.stringify([])),c.puzzle.insert(a[$.storage.lvl]),$(window).trigger("levelUpdate")}},c.init={status:!1,board:function(){$(document.documentElement).addClass("ready"),c.animate.board()},all:function(){c.puzzle.init(),c.init.board(),c.init.status=!0},verify:function(){$(window).addEvent("resize",c.onResizeWindow),c.screen.isTooSmall()||c.init.all()}},c.screen={isTooSmall:function(){return $.docHeight()<d.screen.minHeight||$.docWidth()<d.screen.minWidth?(c.screen.disable("too-small"),!0):(c.screen.enable("too-small"),!1)},disable:function(a){$("#"+a).show()},enable:function(a){$("#"+a).hide()}},c.updateOffsets=function(){window.board.offset.left=c.$.play[0].offsetLeft,window.board.offset.top=c.$.play[0].offsetTop},c.onResizeWindow=function(){c.screen.isTooSmall()||(c.init.status===!1&&c.init.all(),c.updateOffsets())},c.animate={board:function(){var a=$.support.transitionEvent;c.$.board.chainEvents(a,[function(){$.delay(c.animate.borders,500)},function(){$(window).trigger("boardReady"),$.delay(function(){c.animate.blocks({where:"in",direction:"bot"})},200)}],!0).addClass("init"),a||(c.animate.borders(),c.animate.blocks({where:"in",direction:"bot"}),$(window).trigger("boardReady"))},borders:function(){c.$.board.addClass("init-border")},blocks:function(a){var b=c.$.play,d=$.support.transitionEvent,e=a.callback,f=function(){b.removeEvent(d,f),typeof e=="function"&&e(),a.where==="in"&&$(window).trigger("puzzleIn")},g="blocks-out-"+a.direction,h="";d&&b.addEvent(d,f),a.force?(b.addClass("blocks-out-bot").removeClass("blocks-out-top").removeClass("blocks-out-far"),d?(h=b[0].innerHTML,b[0].innerHTML="",b[0].innerHTML=h,c.puzzle.rebind(),$.delay(function(){b.removeClass(g)},200)):b.removeClass(g)):a.where==="in"?b.removeClass(g):a.where==="out"&&($(window).trigger("puzzleOut"),b.addClass(g)),d||f()},keyBlock:function(a,b){var c=$(a),d=$.support.transitionEvent,e=function(){c.removeEvent(d,e).remove(),b&&$.delay(b,0)};c.addEvent(d,e).addClass("out"),!d&&b&&b()}},c.credit=function(){},window.game=c}(window.puzzle,window.dragDrop);